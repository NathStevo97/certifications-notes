# 4.13 - AquaSec Tracee

- Open-source tool used for tracing container syscalls
- Makes use of EBPF to trace the system at runtime without interfering with the Kernel:
  - extended Berkeley Packet filter
- Tracee can be easily ran as a container:
- **Prerequisites:**
  - As ran as a container, it runs the EBFP program and stores it at /tmp/tracee
by default
  - To ensure built once and usable for successive runs, a set number of bind mounts are required:

    | Mount          | Purpose              |
    |----------------|----------------------|
    | `/tmp/tracee`  | Default Workspace    |
    | `/lib/modules` | Kernel Header Access |
    | `/usr/src`     | Kernel Header Access |

  - Addtionally, due to tracing syscalls, Tracee requires privileged capabilities:

- **Using Tracee:**
  - To observe syscalls generated by a single command: <br>

    ```shell
    docker run --name tracee --rm --privileged --pid=host \
    -v /lib/modules/:/lib/modules/:ro -v /usr/src:/usr/src:ro \
    -v /tmp/tracee:/tmp/tracee aqasec/tracee:0.4.0 --trace comm=ls
    ```

  - Returns syscalls made during the run of the ls command
  - To observe syscalls for all new processes on the host:

    ```shell
    docker run --name tracee --rm --privileged --pid=host \
    -v /lib/modules/:/lib/modules/:ro -v /usr/src:/usr/src:ro \
    -v /tmp/tracee:/tmp/tracee aqasec/tracee:0.4.0 --trace pid=new
    ```

  - For new containers:

    ```shell
    docker run --name tracee --rm --privileged --pid=host \
    -v /lib/modules/:/lib/modules/:ro -v /usr/src:/usr/src:ro \
    -v /tmp/tracee:/tmp/tracee aqasec/tracee:0.4.0 --trace container=new
    ```
